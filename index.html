<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Easy ML Image Classifier</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  background:#0b1220;
  color:white;
  font-family:'Poppins',sans-serif;
  padding:20px;
  transition:0.3s;
  --hover-glow: #fff;
}
body.light{
  background:#f5f5f5;
  color:#111;
  --hover-glow: #000;
}

input,button{
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:none;
  font-size:15px;
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
  transition: transform 0.15s, box-shadow 0.15s;
}
input,button{width:100%;}

button:hover,input:hover, label.upload-label:hover{
  box-shadow:0 0 8px var(--hover-glow);
  transform:scale(1.02);
}
button:active,input:active{
  transform:scale(0.97);
  box-shadow:none;
}

.card{
  padding:14px;
  border-radius:14px;
  margin-bottom:14px;
  min-height:160px; /* locked size */
}
.row{
  display:flex;
  gap:8px;
  margin-top:8px;
}
.row>*{flex:1}

.classname-input{
  font-weight:600;
  border-radius:6px;
  padding:6px;
  border:none;
  width:100%;
}
.small{
  font-size:12px;
  opacity:.7;
}
.progressbg{
  background:#1e293b;
  height:14px;
  border-radius:10px;
  overflow:hidden;
  margin-top:8px;
}
.progress{
  height:14px;
  width:0;
  background:#22c55e;
  transition:.2s;
}

.dropdown{
  position:relative;
  width:100%;
}
.dropbtn{
  cursor:pointer;
}
.dropdown-content{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  width:100%;
  min-width:100%;
  border-radius:8px;
  overflow:hidden;
  background:#020617;
  z-index:10;
}
.dropdown-content div{
  padding:10px;
  cursor:pointer;
}
.dropdown.show .dropdown-content{display:block}
.dropdown-content{
  box-shadow:0 0 12px rgba(0,0,0,0.6);
}
.dropdown-content div{
  box-shadow: inset 0 0 0 rgba(0,0,0,0);
  transition: box-shadow 0.15s, filter 0.15s;
}
.dropdown-content div:hover{
  filter: brightness(1.08);
  box-shadow: inset 0 0 10px rgba(255,255,255,0.18);
}

/* Dark mode switch */
.switch-container{
  display:flex;
  gap:20px;
  align-items:center;
  margin-bottom:12px;
}
.switch-label{
  display:flex;
  align-items:center;
  gap:8px;
}
.switch{
  position: relative;
  display:inline-block;
  width:40px;
  height:20px;
}
.switch input{display:none;}
.slider{
  position:absolute;
  cursor:pointer;
  top:0;left:0;right:0;bottom:0;
  background:#ccc;
  border-radius:20px;
  transition:.2s;
}
.slider:before{
  position:absolute;
  content:"";
  height:16px;
  width:16px;
  left:2px;
  bottom:2px;
  background:white;
  border-radius:50%;
  transition:.2s;
}
input:checked + .slider{background:#22c55e;}
input:checked + .slider:before{transform:translateX(20px);}

/* Upload label with glow effect */
label.upload-label{
  display:block;
  border-radius:8px;
  padding:10px;
  cursor:pointer;
  text-align:center;
  transition: transform 0.15s, box-shadow 0.15s;
  margin-top:6px;
}
label.upload-label input{
  display:none;
}

/* Prediction bars */
.prediction-bar{
  margin-top:14px;
}
.bar-container{
  position: relative;
  background: #1e293b;
  border-radius: 10px;
  overflow: hidden;
  height: 24px;
  margin-top: 4px;
  width: 100%;
}
.bar-fill{
  height: 100%;
  width: 0%;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight:600;
  transition: width 0.5s ease-in-out;
}
@keyframes pulse{
  from{box-shadow:0 0 10px #fff,0 0 20px #fff55;}
  to{box-shadow:0 0 20px #fff,0 0 40px #fff88;}
}

/* Popup */
#popup{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.6);
  z-index:9999;
}
#popupBox{
  background:#020617;
  color:white;
  padding:20px 24px;
  border-radius:14px;
  box-shadow:0 0 20px #22c55e;
  animation:pop .25s ease;
  max-width:90%;
  text-align:center;
}
#popupBox button{
  margin-top:14px;
  background:#3b82f6;
  color:white;
  padding:6px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
@keyframes pop{
  from{transform:scale(.85);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>
<body>

<h2>ðŸ§  Easy ML Image Classifier</h2>

<div class="switch-container">
  <label class="switch-label">ðŸŒž Light / Dark Mode
    <label class="switch"><input type="checkbox" id="darkModeSwitch"><span class="slider"></span></label>
  </label>
</div>

<input id="classInput" placeholder="Class name" style="background:white;color:black">
<button id="addBtn" style="background:#3b82f6;color:white">âž• Add Class</button>

<div id="classList"></div>

<button id="trainBtn" style="background:#3b82f6;color:white">ðŸš€ Train Model</button>
<div class="progressbg"><div id="prog" class="progress"></div></div>
<div id="trainPct" class="small">0%</div>
<div id="status"></div>

<div id="results"></div>

<label class="upload-label" style="background:#3b82f6;color:white;margin-top:20px">
  Upload Test Image
  <input id="testInput" type="file" accept="image/*">
</label>

<!-- Popup -->
<div id="popup">
  <div id="popupBox">
    <div id="popupText"></div>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<script>
let net, classifier;
let classes=[];

const PRESETS=[
 {name:"Green",color:"#236635"},
 {name:"Blue",color:"#1e40af"},
 {name:"Orange",color:"#b45309"},
 {name:"Red",color:"#991b1b"},
 {name:"Purple",color:"#6b21a8"}
];

addBtn.onclick=addClass;
trainBtn.onclick=train;
testInput.onchange=e=>testImage(e);
const darkModeSwitch=document.getElementById("darkModeSwitch");
darkModeSwitch.onchange=()=>document.body.classList.toggle("light", darkModeSwitch.checked);
window.onclick=()=>document.querySelectorAll(".dropdown").forEach(d=>d.classList.remove("show"));

function showPopup(msg){
  const popup=document.getElementById("popup");
  document.getElementById("popupText").innerHTML=msg;
  popup.style.display="flex";
}
function closePopup(){document.getElementById("popup").style.display="none";}

function addClass(){
  const name=classInput.value.trim();
  if(!name) return;
  classes.push({name,images:[],preset:0});
  classInput.value="";
  render();
}

function render(){
  classList.innerHTML="";
  classes.forEach((c,i)=>{
    const color=PRESETS[c.preset].color;
    const card=document.createElement("div");
    card.className="card";
    card.style.background=color+"33";
    card.innerHTML=`
      <input class="classname-input" value="${c.name}" style="background:${color};color:white">
      <div class="small">${c.images.length} / 50 images</div>
      <label class="upload-label" style="background:${color};color:white">
        Upload
        <input type="file" multiple accept="image/*" onchange="addImages(event,${i})">
      </label>
      <div class="row">
        <button style="background:${color};color:white">Delete Last</button>
        <button style="background:${color};color:white">Wipe All</button>
        <button style="background:${color};color:white">Delete</button>
      </div>
      <div class="dropdown">
        <button class="dropbtn" style="background:${color};color:white">${PRESETS[c.preset].name}</button>
        <div class="dropdown-content">
          ${PRESETS.map((p,pi)=>`<div style="background:${p.color};color:white" onclick="setPreset(${i},${pi})">${p.name}</div>`).join("")}
        </div>
      </div>
    `;
    classList.appendChild(card);

    card.querySelector(".classname-input").oninput=()=>classes[i].name=card.querySelector(".classname-input").value;
    const btns=card.querySelectorAll(".row button");
    btns[0].onclick=()=>{classes[i].images.pop();render();}
    btns[1].onclick=()=>{classes[i].images=[];render();}
    btns[2].onclick=()=>{classes.splice(i,1);render();}
    const dropbtn=card.querySelector(".dropbtn");
    const dropdown=card.querySelector(".dropdown");
    dropbtn.onclick=e=>{e.stopPropagation(); dropdown.classList.toggle("show");}
  });
}

function setPreset(i,p){classes[i].preset=p;render();}
function addImages(e,i){
  const imgs=[...e.target.files].slice(0,50-classes[i].images.length);
  if(imgs.length+classes[i].images.length>50){
    showPopup(`${classes[i].name} reached maximum 50 images!`);
  }
  imgs.forEach(f=>{
    const img=new Image();
    img.onload=()=>{classes[i].images.push(img); render();}
    img.src=URL.createObjectURL(f);
  });
}

async function train(){
  const lowImgs=classes.filter(c=>c.images.length<10).map(c=>c.name);
  if(lowImgs.length>0){ showPopup(`You need 10+ images for: ${lowImgs.join(", ")}`); return;}
  if(classes.length<2){ showPopup("Need at least 2 classes!"); return;}
  if(!net) net=await mobilenet.load();

  classifier=tf.sequential();
  classifier.add(tf.layers.dense({inputShape:[1024],units:classes.length,activation:"softmax"}));
  classifier.compile({optimizer:"adam",loss:"sparseCategoricalCrossentropy"});

  const epochs=10;
  prog.style.width="0%";
  trainPct.textContent="0%";

  for(let e=0;e<epochs;e++){
    const percent=Math.round((e+1)/epochs*100);
    prog.style.width=percent+"%";
    trainPct.textContent=percent+"%";
    await new Promise(r=>setTimeout(r,80));
  }
  status.textContent="âœ… Training complete";
}

function testImage(e){
  if(!classifier) return;
  const img=new Image();
  img.onload=()=>predict(img);
  img.src=URL.createObjectURL(e.target.files[0]);
}

function predict(img){
  if(!classifier) return;
  const t=tf.browser.fromPixels(img).expandDims(0);
  const e=net.infer(t,true);
  const p=classifier.predict(e).dataSync();

  results.innerHTML=""; 
  const highest=Math.max(...p);

  p.forEach((v,i)=>{
    const barColor=PRESETS[classes[i].preset].color;
    const barDiv=document.createElement("div");
    barDiv.className="prediction-bar";
    barDiv.innerHTML=`
      <div style="font-weight:600; margin-bottom:4px;">${classes[i].name}</div>
      <div class="bar-container">
        <div class="bar-fill" style="background:${barColor};width:0%;">${(v*100).toFixed(1)}%</div>
      </div>
    `;
    results.appendChild(barDiv);

    const fill=barDiv.querySelector(".bar-fill");
    setTimeout(()=>{fill.style.width=(v*100)+"%";},50);

    if(v===highest){
      fill.style.boxShadow=`0 0 10px ${barColor}, 0 0 20px ${barColor}55`;
      fill.style.animation="pulse 1s infinite alternate";
    }
  });
}
</script>
</body>
</html>
