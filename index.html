<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Easy ML Image Classifier</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
<style>
body{background:#0b1220;color:white;font-family:system-ui;padding:20px;}
h2{margin-top:0}
input,button,select{padding:8px;margin-top:6px;border-radius:8px;border:none;font-size:14px;box-sizing:border-box;transition:0.3s;}
input.classNameInput{background:white;color:black;width:100%;text-align:left;}
button,input[type=file]{outline:none;width:100%;}
button:hover,input[type=file]:hover{filter:brightness(1.1);box-shadow:0 0 12px currentColor;}
.card{padding:14px;border-radius:14px;margin-bottom:14px;}
.small{font-size:12px;opacity:.7}
.row{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;}
.row > *{flex:1;}
.progressbg{background:#1e293b;height:14px;border-radius:10px;overflow:hidden;margin-top:8px;}
.progress{height:14px;width:0;background:#22c55e;transition:.2s}
.barbg{background:#1e293b;border-radius:8px;overflow:hidden;margin-top:6px;}
.bar{height:18px;display:flex;align-items:center;justify-content:flex-end;padding-right:6px;font-size:12px;color:white;text-shadow:1px 1px 2px black;}
.classname{padding:6px;border-radius:6px;margin-bottom:6px;font-weight:bold;text-align:left;}
select{appearance:none; -webkit-appearance:none; -moz-appearance:none; padding:6px; border-radius:6px; border:none; cursor:pointer;}
</style>
</head>
<body>

<h2>ðŸ§  Easy Image Classifier</h2>
<input id="classInput" class="classNameInput" placeholder="Class name">
<button id="addBtn" style="background:#3b82f6; color:white">âž• Add Class</button>
<div id="classList"></div>
<button id="trainBtn" style="background:#3b82f6; color:white">ðŸš€ Train Model</button>
<div class="progressbg"><div id="prog" class="progress"></div></div>
<div id="status"></div>
<h3>Test Image</h3>
<input id="testInput" type="file" accept="image/*" style="background:#3b82f6; color:white">
<div id="results"></div>

<script>
let net, classifier;
let classes=[];

const PRESETS=[
  {name:"Green", shades:["#1f4d2b","#236635","#2b7a3b"]},
  {name:"Blue", shades:["#1e40af","#1e3a8a","#1e3fbb"]},
  {name:"Orange", shades:["#8a3b0b","#b45309","#c76a0d"]},
  {name:"Red", shades:["#7a1a1a","#991b1b","#b91c1c"]},
  {name:"Purple", shades:["#4b1073","#6b21a8","#7e22ce"]}
];

function addHoverGlow(el){
  el.onmouseover=()=>el.style.boxShadow=`0 0 12px ${el.style.backgroundColor}`;
  el.onmouseout=()=>el.style.boxShadow=`none`;
}

document.getElementById("addBtn").onclick=()=>{addClass();};
document.getElementById("trainBtn").onclick=()=>{train();};
document.getElementById("testInput").onchange=(e)=>{testImage(e);};

function addClass(){
  const name=document.getElementById("classInput").value.trim();
  if(!name) return alert("Enter class name");
  classes.push({name,images:[],preset:0,shade:1});
  document.getElementById("classInput").value="";
  render();
}

function deleteClass(i){classes.splice(i,1);render();}
function wipeImages(i){classes[i].images=[];render();}
function deleteLastImage(i){classes[i].images.pop();render();}
function setPreset(ci,pi){classes[ci].preset=parseInt(pi); classes[ci].shade=1; render();}

function render(){
  const classList=document.getElementById("classList");
  classList.innerHTML="";
  classes.forEach((c,i)=>{
    const color=PRESETS[c.preset].shades[c.shade];
    const card=document.createElement("div");
    card.className="card";
    card.style.background=color+"33";

    // gradient string for select background
    const gradientStr = PRESETS.map(p=>p.shades[1]).join(',');
    
    card.innerHTML=`
      <div class="classname" style="background:${color}; color:white">${c.name}</div>
      <div class="small">${c.images.length} images</div>
      <input type="file" accept="image/*" multiple style="background:${color}; color:white; width:100%">
      <div class="row">
        <button style="background:${color}; color:white">Delete Last</button>
        <button style="background:${color}; color:white">Wipe All</button>
        <button style="background:${color}; color:white">Delete Class</button>
      </div>
      <div class="row">
        <select style="background:linear-gradient(to right, ${PRESETS.map(p=>p.shades[1]).join(',')}); color:white">
          ${PRESETS.map((p,pi)=>`<option value="${pi}">${p.name}</option>`).join("")}
        </select>
      </div>`;
    classList.appendChild(card);

    const fileInput=card.querySelector("input[type=file]");
    fileInput.onchange=(e)=>addImages(e,i);
    addHoverGlow(fileInput);

    const btns=card.querySelectorAll("button");
    btns[0].onclick=()=>deleteLastImage(i);
    btns[1].onclick=()=>wipeImages(i);
    btns[2].onclick=()=>deleteClass(i);
    btns.forEach(b=>addHoverGlow(b));

    const sel=card.querySelector("select");
    sel.value=c.preset;
    sel.onchange=()=>setPreset(i,sel.value);
    // remove hover effect for select
  });
}

function addImages(e,i){
  for(const f of e.target.files){
    const img=new Image();
    img.onload=()=>{classes[i].images.push(img);render();}
    img.src=URL.createObjectURL(f);
  }
}

async function train(){
  if(classes.length<2) return alert("Need 2+ classes");
  if(classes.some(c=>c.images.length<5)) return alert("Each class needs 5+ images");
  document.getElementById("status").textContent="Loading model...";
  if(!net) net=await mobilenet.load();

  const xs=[], ys=[];
  classes.forEach((c,i)=>{
    c.images.forEach(img=>{
      const t=tf.browser.fromPixels(img).expandDims(0);
      xs.push(net.infer(t,true));
      ys.push(i);
      t.dispose();
    });
  });

  const x=tf.concat(xs);
  const y=tf.tensor1d(ys,"int32");

  classifier=tf.sequential();
  classifier.add(tf.layers.dense({inputShape:[1024],units:classes.length,activation:"softmax"}));
  classifier.compile({optimizer:tf.train.adam(0.0003),loss:"sparseCategoricalCrossentropy"});

  for(let i=0;i<20;i++){
    await classifier.fit(x,y,{epochs:1});
    document.getElementById("prog").style.width=((i+1)/20*100)+"%";
  }

  document.getElementById("status").textContent="âœ… Training complete";
  x.dispose(); y.dispose(); xs.forEach(t=>t.dispose());
}

function testImage(e){
  if(!classifier) return alert("Train first");
  const img=new Image();
  img.onload=()=>predict(img);
  img.src=URL.createObjectURL(e.target.files[0]);
}

function predict(img){
  const t=tf.browser.fromPixels(img).expandDims(0);
  const e=net.infer(t,true);
  const p=classifier.predict(e).dataSync();
  const results=document.getElementById("results");
  results.innerHTML="";
  p.forEach((v,i)=>{
    const pct=(v*100).toFixed(1);
    const color=PRESETS[classes[i].preset].shades[classes[i].shade];
    results.innerHTML+=`
      <div>${classes[i].name}</div>
      <div class="barbg">
        <div class="bar" style="width:${pct}%; background:${color};">
          ${pct}%
        </div>
      </div>`;
  });
  t.dispose(); e.dispose();
}

render();
</script>
</body>
</html>
