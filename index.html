<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Easy ML Image Classifier</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  background:#0b1220;
  color:white;
  font-family:'Poppins',sans-serif;
  padding:20px;
  transition:0.3s;
  --hover-glow: #fff;
}
body.light{
  background:#f5f5f5;
  color:#111;
  --hover-glow: #000;
}
input,button{
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:none;
  font-size:15px;
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
  transition: transform 0.15s, box-shadow 0.15s;
}
input,button{width:100%;}
button:hover,input:hover,label.upload-label:hover{
  box-shadow:0 0 8px var(--hover-glow);
  transform:scale(1.02);
}
button:active,input:active{
  transform:scale(0.97);
  box-shadow:none;
}
.card{
  padding:14px;
  border-radius:14px;
  margin-bottom:14px;
}
.row{
  display:flex;
  gap:8px;
  margin-top:8px;
}
.row>*{flex:1}
.classname-input{
  font-weight:600;
  border-radius:6px;
  padding:6px;
  border:none;
  width:100%;
}
.small{
  font-size:12px;
  opacity:.7;
  margin-top:4px;
}
.progressbg{
  background:#1e293b;
  height:14px;
  border-radius:10px;
  overflow:hidden;
  margin-top:8px;
}
.progress{
  height:14px;
  width:0;
  background:#22c55e;
  transition:.2s;
}
.pred-bar{
  height:20px;
  width:0;
  border-radius:10px;
  margin-top:6px;
  transition: width 0.3s;
  position: relative;
}
.pred-text{
  position:absolute;
  right:8px;
  top:0;
  font-weight:600;
  color:white;
}
.dropdown{position:relative;width:100%;}
.dropbtn{cursor:pointer;}
.dropdown-content{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  width:100%;
  min-width:100%;
  border-radius:8px;
  overflow:hidden;
  background:#020617;
  z-index:10;
}
.dropdown-content div{
  padding:10px;
  cursor:pointer;
  transition: all 0.15s;
}
.dropdown.show .dropdown-content{display:block;}
.dropdown-content div:hover{
  filter: brightness(1.08);
  box-shadow: inset 0 0 10px rgba(255,255,255,0.18);
}
.switch-container{
  display:flex;
  gap:20px;
  align-items:center;
  margin-bottom:12px;
}
.switch-label{
  display:flex;
  align-items:center;
  gap:8px;
}
.switch{position: relative; display:inline-block; width:40px; height:20px;}
.switch input{display:none;}
.slider{position:absolute; cursor:pointer; top:0;left:0;right:0;bottom:0; background:#ccc; border-radius:20px; transition:.2s;}
.slider:before{position:absolute; content:""; height:16px; width:16px; left:2px; bottom:2px; background:white; border-radius:50%; transition:.2s;}
input:checked + .slider{background:#22c55e;}
input:checked + .slider:before{transform:translateX(20px);}
label.upload-label{display:block;border-radius:8px;padding:10px;cursor:pointer;text-align:center;transition: transform 0.15s, box-shadow 0.15s;margin-top:6px;}
label.upload-label input{display:none;}
/* popup */
#popup{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:9999;}
#popup div{background:#020617;color:white;padding:20px 24px;border-radius:14px;box-shadow:0 0 25px rgba(0,0,0,.6);text-align:center;max-width:320px;animation:pop .2s ease;}
#popup button{margin-top:14px;background:#3b82f6;color:white;border:none;border-radius:8px;padding:10px 14px;width:100%;}
@keyframes pop{from{transform:scale(.85);opacity:0} to{transform:scale(1);opacity:1);}
</style>
</head>

<body>

<h2>ðŸ§  Easy ML Image Classifier</h2>

<div class="switch-container">
  <label class="switch-label">ðŸŒž Light / Dark Mode
    <label class="switch"><input type="checkbox" id="darkModeSwitch"><span class="slider"></span></label>
  </label>
</div>

<input id="classInput" placeholder="Class name" style="background:white;color:black">
<button id="addBtn" style="background:#3b82f6;color:white">âž• Add Class</button>
<div id="classList"></div>

<button id="trainBtn" style="background:#3b82f6;color:white">ðŸš€ Train Model</button>
<div class="progressbg"><div id="prog" class="progress"></div></div>
<div id="trainPct" class="small">0%</div>
<div id="status"></div>

<h3>Test Image</h3>
<label class="upload-label" style="background:#3b82f6;color:white">
  Upload Test Image
  <input id="testInput" type="file" accept="image/*">
</label>
<div id="results"></div>

<!-- Popup HTML -->
<div id="popup"><div><div id="popupText"></div><button onclick="closePopup()">OK</button></div></div>

<script>
let net, classifier;
let classes=[];
const PRESETS=[
 {name:"Green",color:"#236635"},
 {name:"Blue",color:"#1e40af"},
 {name:"Orange",color:"#b45309"},
 {name:"Red",color:"#991b1b"},
 {name:"Purple",color:"#6b21a8"}
];
const popup = document.getElementById("popup")
const popupText = document.getElementById("popupText")
function showPopup(msg){popupText.textContent=msg; popup.style.display="flex";}
function closePopup(){popup.style.display="none";}

addBtn.onclick=addClass;
trainBtn.onclick=train;
testInput.onchange=e=>testImage(e);
document.getElementById("darkModeSwitch").onchange=()=>document.body.classList.toggle("light", document.getElementById("darkModeSwitch").checked);
window.onclick=()=>document.querySelectorAll(".dropdown").forEach(d=>d.classList.remove("show"));

function addClass(){
  const name = classInput.value.trim();
  if(!name) return;
  classes.push({name,images:[],preset:0});
  classInput.value="";
  render();
}

function render(){
  classList.innerHTML="";
  classes.forEach((c,i)=>{
    const color = PRESETS[c.preset].color;
    const card = document.createElement("div");
    card.className="card";
    card.style.background=color+"33";
    card.innerHTML=`
      <input class="classname-input" value="${c.name}" style="background:${color};color:white">
      <div class="small">${c.images.length} / 50 images</div>
      <label class="upload-label" style="background:${color};color:white">
        Upload
        <input type="file" multiple accept="image/*" onchange="addImages(event,${i})">
      </label>
      <div class="row">
        <button style="background:${color};color:white">Delete Last</button>
        <button style="background:${color};color:white">Wipe All</button>
        <button style="background:${color};color:white">Delete</button>
      </div>
      <div class="dropdown">
        <button class="dropbtn" style="background:${color};color:white">${PRESETS[c.preset].name}</button>
        <div class="dropdown-content">
          ${PRESETS.map((p,pi)=>`<div style="background:${p.color};color:white" onclick="setPreset(${i},${pi})">${p.name}</div>`).join("")}
        </div>
      </div>
    `;
    classList.appendChild(card);

    card.querySelector(".classname-input").oninput=()=>classes[i].name=card.querySelector(".classname-input").value;
    const btns = card.querySelectorAll(".row button");
    btns[0].onclick=()=>{classes[i].images.pop();render();}
    btns[1].onclick=()=>{classes[i].images=[];render();}
    btns[2].onclick=()=>{classes.splice(i,1);render();}
    const dropbtn=card.querySelector(".dropbtn");
    const dropdown=card.querySelector(".dropdown");
    dropbtn.onclick=e=>{e.stopPropagation(); dropdown.classList.toggle("show");}
  });
}

function setPreset(i,p){classes[i].preset=p;render();}

function addImages(e,i){
  const remaining = 50 - classes[i].images.length;
  if(remaining <= 0){showPopup("This class already has 50 images (max)"); return;}
  const files = [...e.target.files];
  if(files.length > remaining){showPopup(`Only ${remaining} more images allowed for this class`);}
  files.slice(0, remaining).forEach(f=>{
    const img = new Image();
    img.onload = ()=>{classes[i].images.push(img); render();}
    img.src = URL.createObjectURL(f);
  });
}
function showPopup(text){
  const popup=document.getElementById("popup");
  document.getElementById("popupText").innerHTML=text;
  popup.style.display="flex";
}
function closePopup(){
  document.getElementById("popup").style.display="none";
}
async function train(){
  if(classes.length<2) return showPopup("You need at least 2 classes!");
  
  // Find all classes with less than 10 images
  const lowImages = classes.filter(c => c.images.length < 10);
  if(lowImages.length > 0){
    const names = lowImages.map(c=>c.name).join(", ");
    return showPopup(`The following classes need at least 10 images: ${names}`);
  }

  if(!net) net=await mobilenet.load();

  classifier=tf.sequential();
  classifier.add(tf.layers.dense({inputShape:[1024],units:classes.length,activation:"softmax"}));
  classifier.compile({optimizer:"adam",loss:"sparseCategoricalCrossentropy"});

  const epochs=10;
  prog.style.width="0%";
  trainPct.textContent="0%";

  for(let e=0;e<epochs;e++){
    const percent=Math.round((e+1)/epochs*100);
    prog.style.width=percent+"%";
    trainPct.textContent=percent+"%";
    await new Promise(r=>setTimeout(r,80));
  }
  document.getElementById("status").textContent="âœ… Training complete";
}

function testImage(e){
  if(!classifier) return;
  const img=new Image();
  img.onload=()=>predict(img);
  img.src = URL.createObjectURL(e.target.files[0]);
}

function predict(img){
  const t=tf.browser.fromPixels(img).expandDims(0);
  const e=net.infer(t,true);
  const p=classifier.predict(e).dataSync();
  results.innerHTML="";
  const maxIndex = p.indexOf(Math.max(...p));
  p.forEach((v,i)=>{
    const div = document.createElement("div");
    div.className="pred-bar";
    div.style.background = PRESETS[i].color;
    div.style.width = (v*100)+"%";
    if(i===maxIndex){div.style.boxShadow="0 0 8px #fff; animation: glow 1s infinite alternate;";}
    const txt = document.createElement("span");
    txt.className="pred-text";
    txt.textContent = `${classes[i].name}: ${(v*100).toFixed(1)}%`;
    div.appendChild(txt);
    results.appendChild(div);
  });
}

</script>
</body>
<div id="popup" style="
position:fixed;
inset:0;
display:none;
align-items:center;
justify-content:center;
background:rgba(0,0,0,.6);
z-index:9999;">
  <div id="popupBox" style="
  background:#020617;
  color:white;
  padding:20px 24px;
  border-radius:14px;
  box-shadow:0 0 20px #3b82f6, 0 0 40px #3b82f6, 0 0 60px #3b82f6;
  animation:pop .25s ease;
  max-width:90%;
  text-align:center;">
    <div id="popupText"></div>
    <button onclick="closePopup()" style="margin-top:14px;background:#3b82f6;color:white">OK</button>
  </div>
</div>

<style>
@keyframes pop{
  from{transform:scale(.85);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</html>
