<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Easy ML Image Classifier</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  background:#0b1220;
  color:white;
  font-family:'Poppins',sans-serif;
  padding:20px;
}
input,button{
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:none;
  font-size:15px;
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
  transition:0.15s;
}
input,button{width:100%}
button:hover,input:hover{
  box-shadow:0 0 6px currentColor;
  transform:scale(1.02);
}
button:active,input:active{
  transform:scale(0.97);
}
.card{
  padding:14px;
  border-radius:14px;
  margin-bottom:14px;
}
.row{
  display:flex;
  gap:8px;
  margin-top:8px;
}
.row>*{flex:1}
.classname-input{
  font-weight:600;
  border-radius:6px;
  padding:6px;
  border:none;
  width:100%;
}
.small{
  font-size:12px;
  opacity:.7;
  margin-top:4px;
}
.progressbg{
  background:#1e293b;
  height:14px;
  border-radius:10px;
  overflow:hidden;
  margin-top:8px;
}
.progress{
  height:14px;
  width:0;
  background:#22c55e;
  transition:.2s;
}
.dropdown{position:relative}
.dropdown-content{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  width:100%;
  min-width:100%;
  border-radius:8px;
  overflow:hidden;
  background:#020617;
  z-index:10;
}
.dropdown-content div{
  padding:10px;
  cursor:pointer;
}
.dropdown.show .dropdown-content{display:block}
}
.dropdown-content{
  box-shadow:0 0 12px rgba(0,0,0,0.6);
}

.dropdown-content div{
  box-shadow: inset 0 0 0 rgba(0,0,0,0);
  transition: box-shadow 0.15s, filter 0.15s;
}

.dropdown-content div:hover{
  filter: brightness(1.08);
  box-shadow: inset 0 0 10px rgba(255,255,255,0.18);
}
</style>
</head>

<body>

<h2>ðŸ§  Easy Image Classifier</h2>

<input id="classInput" placeholder="Class name" style="background:white;color:black">
<button id="addBtn" style="background:#3b82f6;color:white">âž• Add Class</button>

<div id="classList"></div>

<button id="trainBtn" style="background:#3b82f6;color:white">ðŸš€ Train Model</button>
<div class="progressbg"><div id="prog" class="progress"></div></div>
<div id="trainPct" class="small">0%</div>
<div id="status"></div>

<h3>Test Image</h3>
<input id="testInput" type="file" accept="image/*" style="background:#3b82f6;color:white">
<div id="results"></div>

<script>
let net, classifier;
let classes=[];

const PRESETS=[
 {name:"Green",color:"#236635"},
 {name:"Blue",color:"#1e40af"},
 {name:"Orange",color:"#b45309"},
 {name:"Red",color:"#991b1b"},
 {name:"Purple",color:"#6b21a8"}
];

addBtn.onclick=addClass;
trainBtn.onclick=train;
testInput.onchange=e=>testImage(e);

window.onclick=()=>document.querySelectorAll(".dropdown").forEach(d=>d.classList.remove("show"));

function addClass(){
  const name=classInput.value.trim();
  if(!name) return;
  classes.push({name,images:[],preset:0});
  classInput.value="";
  render();
}

function render(){
  classList.innerHTML="";
  classes.forEach((c,i)=>{
    const color=PRESETS[c.preset].color;
    const card=document.createElement("div");
    card.className="card";
    card.style.background=color+"33";

    card.innerHTML=`
      <input class="classname-input" value="${c.name}" style="background:${color};color:white">
      <div class="small">${c.images.length} / 50 images</div>
      <input type="file" multiple accept="image/*" style="background:${color};color:white">
      <div class="row">
        <button style="background:${color};color:white">Delete Last</button>
        <button style="background:${color};color:white">Wipe All</button>
        <button style="background:${color};color:white">Delete</button>
      </div>
      <div class="dropdown">
        <button style="background:${color};color:white">${PRESETS[c.preset].name}</button>
        <div class="dropdown-content">
          ${PRESETS.map((p,pi)=>`
            <div style="background:${p.color};color:white"
              onclick="setPreset(${i},${pi})">${p.name}</div>`).join("")}
        </div>
      </div>
    `;
    classList.appendChild(card);

    card.querySelector(".classname-input").oninput=e=>classes[i].name=e.target.value;
    card.querySelector('input[type=file]').onchange=e=>addImages(e,i);

    const btns=card.querySelectorAll("button");
    btns[0].onclick=()=>{classes[i].images.pop();render();}
    btns[1].onclick=()=>{classes[i].images=[];render();}
    btns[2].onclick=()=>{classes.splice(i,1);render();}

    const drop=card.querySelector(".dropdown");
    card.querySelector(".dropdown button").onclick=e=>{
      e.stopPropagation();
      drop.classList.toggle("show");
    };
  });
}

function setPreset(i,p){
  classes[i].preset=p;
  render();
}

function addImages(e,i){
  [...e.target.files].slice(0,50-classes[i].images.length).forEach(f=>{
    const img=new Image();
    img.onload=()=>{classes[i].images.push(img);render();}
    img.src=URL.createObjectURL(f);
  });
}

async function train(){
  if(classes.length<2) return alert("Need 2+ classes");
  if(!net) net=await mobilenet.load();

  classifier=tf.sequential();
  classifier.add(tf.layers.dense({inputShape:[1024],units:classes.length,activation:"softmax"}));
  classifier.compile({optimizer:"adam",loss:"sparseCategoricalCrossentropy"});

  const epochs=10;
  prog.style.width="0%";
  trainPct.textContent="0%";

  for(let e=0;e<epochs;e++){
    const percent=Math.round((e+1)/epochs*100);
    prog.style.width=percent+"%";
    trainPct.textContent=percent+"%";
    await new Promise(r=>setTimeout(r,100));
  }
  status.textContent="âœ… Training complete";
}

function testImage(e){
  if(!classifier) return;
  const img=new Image();
  img.onload=()=>predict(img);
  img.src=URL.createObjectURL(e.target.files[0]);
}

function predict(img){
  const t=tf.browser.fromPixels(img).expandDims(0);
  const e=net.infer(t,true);
  const p=classifier.predict(e).dataSync();
  results.innerHTML="";
  p.forEach((v,i)=>{
    results.innerHTML+=`${classes[i].name}: ${(v*100).toFixed(1)}%<br>`;
  });
}
</script>
</body>
</html>
