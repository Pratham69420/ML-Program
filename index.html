<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ML Science Fair</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<style>
body { font-family: Arial; background:#111; color:white; text-align:center }
video { border:2px solid white; margin:10px }
button { margin:5px; padding:10px; font-size:16px }
.bar { height:20px; background:#0f0; margin:4px }
</style>
</head>

<body>

<h2>Grade 7 Machine Learning Project ðŸ¤–</h2>

<video id="webcam" autoplay playsinline width="200" height="200"></video>

<div id="classes"></div>

<button onclick="train()">Train Model</button>
<button onclick="predict()">Live Test</button>

<h3>Predictions</h3>
<div id="results"></div>

<script>
const NUM_CLASSES = 3
const samples = [[], [], []]
let model, webcam

async function setupCamera() {
  webcam = document.getElementById("webcam")
  const stream = await navigator.mediaDevices.getUserMedia({ video: true })
  webcam.srcObject = stream
}
setupCamera()

function createUI() {
  const div = document.getElementById("classes")
  for (let i = 0; i < NUM_CLASSES; i++) {
    div.innerHTML += `
      <h3>Class ${i + 1}</h3>
      <button onclick="capture(${i})">ðŸ“¸ Capture Image</button>
      <span id="count${i}">0 images</span>
    `
  }
}
createUI()

function capture(classIndex) {
  const canvas = document.createElement("canvas")
  canvas.width = 224
  canvas.height = 224
  const ctx = canvas.getContext("2d")
  ctx.drawImage(webcam, 0, 0, 224, 224)
  samples[classIndex].push(canvas)
  document.getElementById("count"+classIndex).innerText =
    samples[classIndex].length + " images"
}

async function train() {
  model = tf.sequential()
  model.add(tf.layers.flatten({inputShape:[224,224,3]}))
  model.add(tf.layers.dense({units:64, activation:"relu"}))
  model.add(tf.layers.dense({units:NUM_CLASSES, activation:"softmax"}))
  model.compile({optimizer:"adam", loss:"categoricalCrossentropy"})

  const xs = []
  const ys = []

  for (let i = 0; i < NUM_CLASSES; i++) {
    for (let img of samples[i]) {
      xs.push(tf.browser.fromPixels(img).toFloat().div(255))
      ys.push(tf.oneHot(i, NUM_CLASSES))
    }
  }

  await model.fit(tf.stack(xs), tf.stack(ys), {epochs:10})
  alert("Training Complete âœ…")
}

async function predict() {
  const canvas = document.createElement("canvas")
  canvas.width = 224
  canvas.height = 224
  canvas.getContext("2d").drawImage(webcam,0,0,224,224)
  const img = tf.browser.fromPixels(canvas).toFloat().div(255).expandDims(0)
  const preds = model.predict(img).dataSync()

  const res = document.getElementById("results")
  res.innerHTML = ""
  preds.forEach((p,i)=>{
    res.innerHTML += `
      <div>Class ${i+1}: ${(p*100).toFixed(1)}%</div>
      <div class="bar" style="width:${p*200}px"></div>
    `
  })
}
</script>

</body>
</html>
