async function train(){
  if(!net) net = await mobilenet.load()

  const xs=[], ys=[]
  const trainProgress = document.getElementById("results")
  trainProgress.innerHTML = "<h3>Training Progress</h3>"

  classes.forEach((c,i)=>{
    c.images.forEach(img=>{
      const t=tf.browser.fromPixels(img).expandDims(0)
      const e=net.infer(t,true)
      xs.push(e)
      ys.push(i)
      t.dispose()
    })
  })

  if(xs.length===0){alert("Add images");return}

  const x=tf.concat(xs)
  const y=tf.tensor1d(ys,"int32")

  classifier=tf.sequential()
  classifier.add(tf.layers.dense({
    inputShape:[1024],
    units:classes.length,
    activation:"softmax"
  }))
  classifier.compile({
    optimizer:tf.train.adam(0.0003),
    loss:"sparseCategoricalCrossentropy",
    metrics:["accuracy"]
  })

  await classifier.fit(x,y,{
    epochs:25,
    callbacks:{
      onEpochEnd:(epoch, logs)=>{
        trainProgress.innerHTML = `<h3>Training Progress</h3>
          Epoch ${epoch+1}/25 — Accuracy: ${(logs.acc*100||0).toFixed(1)}%`
      },
      onTrainEnd:()=>{
        trainProgress.innerHTML += "<p>✅ Training Complete!</p>"
        setupBars()
      }
    }
  })

  x.dispose(); y.dispose(); xs.forEach(t=>t.dispose())
}
