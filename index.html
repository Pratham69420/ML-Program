<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ML Image Classifier</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

<style>
body{margin:0;font-family:system-ui;background:#020617;color:white}
header{text-align:center;padding:12px;font-size:22px}

.main{
  display:grid;
  grid-template-columns:360px 1fr;
  gap:14px;
  padding:14px;
}

.panel{
  border:1px solid #1e293b;
  border-radius:12px;
  padding:12px;
}

video{width:100%;border-radius:10px}

button{
  width:100%;
  padding:8px;
  margin-top:6px;
  border:none;
  border-radius:8px;
  background:#2563eb;
  color:white;
  cursor:pointer;
}

.small{background:#334155}
.danger{background:#dc2626}

input{
  width:100%;
  padding:6px;
  border-radius:6px;
  border:none;
  margin-top:6px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:10px;
}

.card{
  border:1px solid #1e293b;
  border-radius:10px;
  padding:8px;
}

.barbg{
  background:#1e293b;
  border-radius:6px;
  overflow:hidden;
}

.bar{
  height:14px;
  background:#22c55e;
}
</style>
</head>

<body>

<header>ğŸ¤– ML Image Classifier</header>

<div class="main">
  <div class="panel">
    <video id="video" autoplay playsinline></video>
    <button onclick="addClass()">â• Add Class</button>
    <button onclick="train()">ğŸš€ Train</button>
    <button onclick="startLive()">ğŸ“¹ Live</button>
  </div>

  <div class="panel">
    <div id="classes" class="grid"></div>
    <h3 id="top">Prediction: â€”</h3>
    <div id="results"></div>
  </div>
</div>

<script>
const video=document.getElementById("video")
const classesDiv=document.getElementById("classes")
const results=document.getElementById("results")
const top=document.getElementById("top")

let classes=[]
let net, model, live=false

navigator.mediaDevices.getUserMedia({video:true})
  .then(s=>video.srcObject=s)

function addClass(){
  classes.push({name:"Class "+(classes.length+1),images:[]})
  render()
}

function render(){
  classesDiv.innerHTML=""
  classes.forEach((c,i)=>{
    classesDiv.innerHTML+=`
    <div class="card">
      <input value="${c.name}" oninput="classes[${i}].name=this.value">
      <button onclick="capture(${i})">ğŸ“¸ Capture</button>
      <button onclick="document.getElementById('up${i}').click()">ğŸ“ Upload</button>
      <input id="up${i}" type="file" hidden multiple onchange="upload(event,${i})">
      <button class="small" onclick="deleteLast(${i})">â†© Delete Last</button>
      <button class="small" onclick="wipeAll(${i})">ğŸ§¹ Wipe All</button>
      <button class="danger" onclick="deleteClass(${i})">âŒ Delete Class</button>
      <div>${c.images.length} images</div>
    </div>`
  })
}

function capture(i){
  const c=document.createElement("canvas")
  c.width=224;c.height=224
  c.getContext("2d").drawImage(video,0,0,224,224)
  classes[i].images.push(c)
  render()
}

function upload(e,i){
  for(const f of e.target.files){
    const img=new Image()
    img.onload=()=>{
      const c=document.createElement("canvas")
      c.width=224;c.height=224
      c.getContext("2d").drawImage(img,0,0,224,224)
      classes[i].images.push(c)
      render()
    }
    img.src=URL.createObjectURL(f)
  }
}

function deleteLast(i){classes[i].images.pop();render()}
function wipeAll(i){classes[i].images=[];render()}
function deleteClass(i){classes.splice(i,1);render()}

async function train(){
  if(!net) net=await mobilenet.load()
  results.innerText="Training..."
  const xs=[],ys=[]
  classes.forEach((c,i)=>{
    c.images.forEach(img=>{
      const t=tf.browser.fromPixels(img).expandDims(0).toFloat().div(255)
      const e=net.infer(t,true)
      xs.push(e);ys.push(i);t.dispose()
    })
  })
  const x=tf.concat(xs)
  const y=tf.tensor1d(ys,"int32")
  model=tf.sequential()
  model.add(tf.layers.dense({inputShape:[x.shape[1]],units:100,activation:"relu"}))
  model.add(tf.layers.dense({units:classes.length,activation:"softmax"}))
  model.compile({optimizer:"adam",loss:"sparseCategoricalCrossentropy"})
  await model.fit(x,y,{epochs:20,callbacks:{
    onTrainEnd:()=>{results
